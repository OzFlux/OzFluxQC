# coding: utf-8
import qcio
import qcutils
import statsmodels.api as sm
duname=qcio.get_filename_dialog()
drname=qcio.get_filename_dialog()
ds_du=qcio.nc_read_series(duname)
ds_dr=qcio.nc_read_series(drname)
dt_du=ds.series["DateTime"]["Data"]
dt_du=ds_du.series["DateTime"]["Data"]
dt_dr=ds_dr.series["DateTime"]["Data"]
print dt_du[0],dt_dr[0]
print dt_du[-1],dt_dr[-1]
ts=ds_du.globalattributes["time_step"]
si=qcutils.GetDateIndex(dt_du,str(dt_du[0]),ts=ts,match="startnextday")
ei=qcutils.GetDateIndex(dt_du,str(dt_dr[-1]),ts=ts,match="endpreviousday")
print si,ei
Fsd_du,f=qcutils.GetSeriesasMA(ds_du,'Fsd',si=si,ei=ei)
Fsd_dr,f=qcutils.GetSeriesasMA(ds_dr,'Fsd',si=si,ei=ei)
plot(Fsd_dr,Fsd_du)
ei=qcutils.GetDateIndex(ds_du,"2009-01-01 00:00",ts=ts,match="endpreviousday")
ei=qcutils.GetDateIndex(dt_du,"2009-01-01 00:00",ts=ts,match="endpreviousday")
fig=figure(1)
Fsd_du_2008,f=qcutils.GetSeriesasMA(ds_du,'Fsd',si=si,ei=ei)
Fsd_dr_2008,f=qcutils.GetSeriesasMA(ds_dr,'Fsd',si=si,ei=ei)
plot(Fsd_du_2008,Fsd_dr_2008,'b.')
Fsd_du_2008.mask=(Fsd_du_2008.mask==True)|(Fsd_dr_2008.mask==True)
Fsd_dr_2008.mask=(Fsd_du_2008.mask==True)|(Fsd_dr_2008.mask==True)
Fsd_du_2008=numpy.ma.compressed(Fsd_du_2008)
Fsd_dr_2008=numpy.ma.compressed(Fsd_dr_2008)
x=Fsd_du_2008
y=Fsd_dr_2008
resrlm=sm.RLM(y,sm.add_constant(x),M=sm.robust.norms.TukeyBiweight()).fit()
print resrlm.params
plot(x,resrlm.fittedvalues,'g-')
xlabel('Fsd_DU (W/m2)')
ylabel('Fsd_DR (W/m2)')
title('Fsd: Daly Uncleared vs Daly Regrowth; 2008')
text(-100,1300,'Fsd_DR = 0.839*Fsd_DU + 0.5')
si=qcutils.GetDateIndex(dt_du,"2009-01-01 00:30",ts=ts,match="startnextday")
ei=qcutils.GetDateIndex(dt_du,"2009-11-01 00:00",ts=ts,match="endpreviousday")
print si,ei
Fsd_du_2009a,f=qcutils.GetSeriesasMA(ds_du,'Fsd',si=si,ei=ei)
Fsd_dr_2009a,f=qcutils.GetSeriesasMA(ds_dr,'Fsd',si=si,ei=ei)
Fsd_du_2009a.mask=(Fsd_du_2009a.mask==True)|(Fsd_dr_2009a.mask==True)
Fsd_dr_2009a.mask=(Fsd_du_2009a.mask==True)|(Fsd_dr_2009a.mask==True)
x=numpy.ma.compressed(Fsd_du_2009a)
y=numpy.ma.compressed(Fsd_dr_2009a)
resrlm=sm.RLM(y,sm.add_constant(x),M=sm.robust.norms.TukeyBiweight()).fit()
print resrlm.params
fig=figure(2)
plot(x,y,'b.')
plot(x,resrlm.fittedvalues,'g-')
xlabel('Fsd_DU (W/m2)')
ylabel('Fsd_DR (W/m2)')
title('Fsd: Daly Uncleared vs Daly Regrowth; 2009')
text(-100,1300,'1/1/2009 to 1/11/2009 Fsd_DR = 0.890*Fsd_DU + 0.1')
si=qcutils.GetDateIndex(dt_du,"2009-11-01 00:30",ts=ts,match="startnextday")
ei=qcutils.GetDateIndex(dt_du,str(dt_dr[-1]),ts=ts,match="endpreviousday")
print si,ei
Fsd_du_2009b,f=qcutils.GetSeriesasMA(ds_du,'Fsd',si=si,ei=ei)
Fsd_dr_2009b,f=qcutils.GetSeriesasMA(ds_dr,'Fsd',si=si,ei=ei)
Fsd_du_2009b.mask=(Fsd_du_2009b.mask==True)|(Fsd_dr_2009b.mask==True)
Fsd_dr_2009b.mask=(Fsd_du_2009b.mask==True)|(Fsd_dr_2009b.mask==True)
x=numpy.ma.compressed(Fsd_du_2009b)
y=numpy.ma.compressed(Fsd_dr_2009b)
resrlm=sm.RLM(y,sm.add_constant(x),M=sm.robust.norms.TukeyBiweight()).fit()
print resrlm.params
plot(x,y,'bo')
fig=figure(2)
x=numpy.ma.compressed(Fsd_du_2009a)
y=numpy.ma.compressed(Fsd_dr_2009a)
resrlm=sm.RLM(y,sm.add_constant(x),M=sm.robust.norms.TukeyBiweight()).fit()
plot(x,y,'b.')
print resrlm.params
xlabel('Fsd_DU (W/m2)')
ylabel('Fsd_DR (W/m2)')
title('Fsd: Daly Uncleared vs Daly Regrowth; 2009')
text(-100,1300,'1/1/2009 to 1/11/2009 Fsd_DR = 0.890*Fsd_DU + 0.1')
plot(x,resrlm.fittedvalues,'g-')
fig=figure(3)
x=numpy.ma.compressed(Fsd_du_2009b)
y=numpy.ma.compressed(Fsd_dr_2009b)
plot(x,y,'b.')
resrlm=sm.RLM(y,sm.add_constant(x),M=sm.robust.norms.TukeyBiweight()).fit()
print resrlm.params
xlabel('Fsd_DU (W/m2)')
ylabel('Fsd_DR (W/m2)')
title('Fsd: Daly Uncleared vs Daly Regrowth; 2009')
text(-100,1300,'1/11/2009 to 9/5/2010 Fsd_DR = 1.02*Fsd_DU - 0.9')
plot(x,resrlm.fittedvalues,'g-')
Fn_KZ_du_2009b,f=qcutils.GetSeriesasMA(ds_du,'Fn_KZ',si=si,ei=ei)
Fn_KZ_dr_2009b,f=qcutils.GetSeriesasMA(ds_dr,'Fn_KZ',si=si,ei=ei)
Fn_KZ_du_2009a.mask=(Fn_KZ_du_2009b.mask==True)|(Fn_KZ_dr_2009b.mask==True)
Fn_KZ_du_2009b.mask=(Fn_KZ_du_2009b.mask==True)|(Fn_KZ_dr_2009b.mask==True)
Fn_KZ_dr_2009b.mask=(Fn_KZ_du_2009b.mask==True)|(Fn_KZ_dr_2009b.mask==True)
x=numpy.ma.compressed(Fn_KZ_du_2009b)
y=numpy.ma.compressed(Fn_KZ_dr_2009b)
resrlm=sm.RLM(y,sm.add_constant(x),M=sm.robust.norms.TukeyBiweight()).fit()
print resrlm.params
fig=figure(4)
plot(x,y,'b.')
xlabel('Fn_KZ_DU (W/m2)')
ylabel('Fn_KZ_DR (W/m2)')
title('Fn_KZ: Daly Uncleared vs Daly Regrowth; 2009')
text(-100,900,'1/11/2009 to 9/5/2010 Fn_KZ_DR = 1.07*Fn_KZ_DU - 2.2')
plot(x,resrlm.fittedvalues,'g-')
Fn_NR_du_2009b,f=qcutils.GetSeriesasMA(ds_du,'Fn_NR',si=si,ei=ei)
Fn_NR_dr_2009b,f=qcutils.GetSeriesasMA(ds_dr,'Fn_NR',si=si,ei=ei)
Fn_NR_dr_2009b.mask=(Fn_NR_du_2009b.mask==True)|(Fn_NR_dr_2009b.mask==True)
Fn_NR_du_2009b.mask=(Fn_NR_du_2009b.mask==True)|(Fn_NR_dr_2009b.mask==True)
x=numpy.ma.compressed(Fn_NR_du_2009b)
y=numpy.ma.compressed(Fn_NR_dr_2009b)
resrlm=sm.RLM(y,sm.add_constant(x),M=sm.robust.norms.TukeyBiweight()).fit()
print resrlm.params
fig=figure(5)
plot(x,y,'b.')
xlabel('Fn_NR_DU (W/m2)')
ylabel('Fn_NR_DR (W/m2)')
title('Fn_NR: Daly Uncleared vs Daly Regrowth; 2009')
text(-100,900,'1/11/2009 to 9/5/2010 Fn_NR_DR = 0.94*Fn_NR_DU - 6.4')
plot(x,resrlm.fittedvalues,'g-')
si_2008=qcutils.GetDateIndex(dt_du,"2008-01-01 00:00",ts=ts,match="startnextday")
ei_2008=qcutils.GetDateIndex(dt_du,"2009-01-01 00:00",ts=ts,match="startnextday")
print si,ei
print si_2008,ei_2008
Fn_NR_du_2008,f=qcutils.GetSeriesasMA(ds_du,'Fn_NR',si=si_2008,ei=ei_2008)
Fn_NR_dr_2008,f=qcutils.GetSeriesasMA(ds_dr,'Fn_NR',si=si_2008,ei=ei_2008)
Fn_NR_du_2008.mask=(Fn_NR_du_2008.mask==True)|(Fn_NR_dr_2008.mask==True)
Fn_NR_dr_2008.mask=(Fn_NR_du_2008.mask==True)|(Fn_NR_dr_2008.mask==True)
x=numpy.ma.compressed(Fn_NR_du_2008)
y=numpy.ma.compressed(Fn_NR_dr_2008)
resrlm=sm.RLM(y,sm.add_constant(x),M=sm.robust.norms.TukeyBiweight()).fit()
print resrlm.params
fig=figure(6)
plot(x,y,'b.')
xlabel('Fn_NR_DU (W/m2)')
ylabel('Fn_NR_DR (W/m2)')
title('Fn_NR: Daly Uncleared vs Daly Regrowth; 2008')
text(-100,900,'Fn_NR_DR = 0.92*Fn_NR_DU - 5.4')
plot(x,resrlm.fittedvalues,'g-')
si_2009=qcutils.GetDateIndex(dt_du,"2009-01-01 00:30",ts=ts,match="startnextday")
ei_2009=qcutils.GetDateIndex(dt_du,"2009-11-01 00:00",ts=ts,match="endpreviousday")
print si_2009,ei_2009
Fn_NR_du_2009a,f=qcutils.GetSeriesasMA(ds_du,'Fn_NR',si=si_2009,ei=ei_2009)
Fn_NR_dr_2009a,f=qcutils.GetSeriesasMA(ds_dr,'Fn_NR',si=si_2009,ei=ei_2009)
Fn_NR_du_2009a.mask=(Fn_NR_du_2009a.mask==True)|(Fn_NR_dr_2009a.mask==True)
Fn_NR_dr_2009a.mask=(Fn_NR_du_2009a.mask==True)|(Fn_NR_dr_2009a.mask==True)
x=numpy.ma.compressed(Fn_NR_du_2009a)
y=numpy.ma.compressed(Fn_NR_dr_2009a)
resrlm=sm.RLM(y,sm.add_constant(x),M=sm.robust.norms.TukeyBiweight()).fit()
print resrlm.params
fig=figure(7)
plot(x,y,'b.')
xlabel('Fn_NR_DU (W/m2)')
ylabel('Fn_NR_DR (W/m2)')
title('Fn_NR: Daly Uncleared vs Daly Regrowth; 2009')
text(-100,900,'1/1/2009 to 1/11/2009 Fn_NR_DR = 1.01*Fn_NR_DU - 0.2')
plot(x,resrlm.fittedvalues,'g-')
Fn_KZ_du_2008,f=qcutils.GetSeriesasMA(ds_du,'Fn_KZ',si=si_2008,ei=ei_2008)
Fn_KZ_dr_2008,f=qcutils.GetSeriesasMA(ds_dr,'Fn_KZ',si=si_2008,ei=ei_2008)
Fn_KZ_du_2008.mask=(Fn_KZ_du_2008.mask==True)|(Fn_KZ_dr_2008.mask==True)
Fn_KZ_dr_2008.mask=(Fn_KZ_du_2008.mask==True)|(Fn_KZ_dr_2008.mask==True)
x=numpy.ma.compressed(Fn_KZ_du_2008)
y=numpy.ma.compressed(Fn_KZ_dr_2008)
resrlm=sm.RLM(y,sm.add_constant(x),M=sm.robust.norms.TukeyBiweight()).fit()
print resrlm.params
fig=figure(8)
plot(x,y,'b.')
plot(x,resrlm.fittedvalues,'g-')
xlabel('Fn_KZ_DU (W/m2)')
ylabel('Fn_KZ_DR (W/m2)')
title('Fn_KZ: Daly Uncleared vs Daly Regrowth; 2008')
text(-100,900,'Fn_KZ_DR = 0.75*Fn_KZ_DU - 2.9')
Fn_KZ_du_2009a,f=qcutils.GetSeriesasMA(ds_du,'Fn_KZ',si=si_2009,ei=ei_2009)
Fn_KZ_dr_2009a,f=qcutils.GetSeriesasMA(ds_dr,'Fn_KZ',si=si_2009,ei=ei_2009)
Fn_KZ_du_2009a.mask=(Fn_KZ_du_2009a.mask==True)|(Fn_KZ_dr_2009a.mask==True)
Fn_KZ_dr_2009a.mask=(Fn_KZ_du_2009a.mask==True)|(Fn_KZ_dr_2009a.mask==True)
x=numpy.ma.compressed(Fn_KZ_du_2009a)
y=numpy.ma.compressed(Fn_KZ_dr_2009a)
resrlm=sm.RLM(y,sm.add_constant(x),M=sm.robust.norms.TukeyBiweight()).fit()
print resrlm.params
fig=figure(9)
plot(x,y,'b.')
plot(x,resrlm.fittedvalues,'g-')
xlabel('Fn_KZ_DU (W/m2)')
ylabel('Fn_KZ_DR (W/m2)')
title('Fn_KZ: Daly Uncleared vs Daly Regrowth; 2009')
text(-100,900,'Fn_KZ_DR = 0.79*Fn_KZ_DU - 1.4')